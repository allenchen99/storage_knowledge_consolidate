# Btrfs æ–‡ä»¶ç³»ç»Ÿä¼˜ç¼ºç‚¹æ€»ç»“

---

## âœ… ä¼˜ç‚¹ï¼šç°ä»£åŒ–çš„è®¾è®¡ + ä¸°å¯Œçš„åŠŸèƒ½

Btrfsï¼ˆB-tree File Systemï¼‰æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ ext4ï¼‰åœ¨å¯æ‰©å±•æ€§ã€æ•°æ®å®Œæ•´æ€§ã€å¿«ç…§ç­‰æ–¹é¢çš„ä¸è¶³è€Œè®¾è®¡çš„ï¼Œå…·æœ‰ä»¥ä¸‹çªå‡ºä¼˜ç‚¹ï¼š

### 1. ğŸ§  å†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Write, CoWï¼‰

- æ‰€æœ‰æ•°æ®å’Œå…ƒæ•°æ®é‡‡ç”¨ CoW å†™å…¥ï¼Œé¿å…ç›´æ¥è¦†ç›–ï¼Œæé«˜æ•°æ®å®‰å…¨æ€§
- æ”¯æŒå¿«ç…§ã€å›æ»šç­‰é«˜çº§åŠŸèƒ½çš„åŸºç¡€

### 2. ğŸª„ å¿«ç…§å’Œå­å·åŠŸèƒ½å¼ºå¤§

- å¿«ç…§å¼€é”€æä½ï¼Œå¯ç¬é—´åˆ›å»º
- æ”¯æŒå­å·ï¼ˆsubvolumeï¼‰ï¼Œå¯ç”¨äºå®ç°ç±»ä¼¼åˆ†åŒºçš„é€»è¾‘ç»“æ„
- å¯ç”¨äºç³»ç»Ÿè¿˜åŸã€å¤‡ä»½ã€æµ‹è¯•ç­‰ç”¨é€”

### 3. ğŸ“¦ å†…å»ºå¤šç§é«˜çº§åŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| **å‹ç¼©** | æ”¯æŒ zlibã€zstdã€lzo ç­‰å¤šç§ç®—æ³• |
| **æ ¡éªŒ** | æ‰€æœ‰æ•°æ®å’Œå…ƒæ•°æ®éƒ½æœ‰ CRC æ ¡éªŒï¼Œç¡®ä¿å®Œæ•´æ€§ |
| **å¢é‡å‘é€/æ¥æ”¶** | `btrfs send/receive` å¯å®ç°å¢é‡å¤‡ä»½/è¿ç§» |
| **åœ¨çº¿æ‰©å®¹/æ”¶ç¼©** | æ”¯æŒåœ¨çº¿æ·»åŠ /åˆ é™¤è®¾å¤‡ã€è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å° |
| **é›†æˆ RAID** | åŸç”Ÿæ”¯æŒ RAID0/1/10ï¼ˆæ³¨æ„ RAID5/6 ä¸ç¨³å®šï¼‰ |

### 4. ğŸ”„ å¿«é€ŸæŒ‚è½½ & ä¿®å¤æ—¶é—´çŸ­

- ç›¸æ¯” ext4 çš„ `fsck`ï¼ŒBtrfs ä¸éœ€è¦æŒ‚è½½å‰å…¨ç›˜æ£€æŸ¥ï¼Œé‡å¯é€Ÿåº¦æ›´å¿«
- å°¤å…¶åœ¨å¤§å®¹é‡æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¼˜åŠ¿æ˜æ˜¾

### 5. ğŸŒ± åŠ¨æ€åˆ†å±‚ç»“æ„

- å…ƒæ•°æ®ä½¿ç”¨ B-tree ç»“æ„ç»„ç»‡ï¼Œå…·å¤‡é«˜æ‰©å±•æ€§
- é€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®ç®¡ç†ï¼Œå¦‚å®¹å™¨/é•œåƒ/åˆ†å¸ƒå¼ç³»ç»Ÿä¸­

---

## â— ç¼ºç‚¹ï¼šç¨³å®šæ€§å’ŒåŠŸèƒ½æˆç†Ÿåº¦ä»æœ‰å·®è·

### 1. ğŸš§ éƒ¨åˆ†åŠŸèƒ½ä»ä¸ç¨³å®šæˆ–ä¸ºå®éªŒæ€§

| åŠŸèƒ½ | é—®é¢˜æè¿° |
|------|----------|
| **RAID5 / RAID6** | å­˜åœ¨ä¸¥é‡æ•°æ®æŸåé£é™©ï¼Œå®˜æ–¹æ ‡è®°ä¸º experimental |
| **é‡å¤æ•°æ®åˆ é™¤** | ä¸å†…å»ºï¼Œéœ€è¦ä½¿ç”¨å¤–éƒ¨å·¥å…·å¦‚ `duperemove` |
| **æ•°æ®æ ¡éªŒå’Œä¿®å¤** | `scrub` è™½æ”¯æŒæ ¡éªŒï¼Œä½†è‡ªåŠ¨ä¿®å¤èƒ½åŠ›è¾ƒå¼± |
| **fsck å·¥å…·ä¸æˆç†Ÿ** | `btrfs check` ä½¿ç”¨å¤æ‚ï¼Œä¸”å®¹æ˜“è¿›ä¸€æ­¥æŸåæ•°æ® |

### 2. ğŸŒ€ æ€§èƒ½é—®é¢˜ï¼ˆå°¤å…¶æ˜¯å†™å¯†é›†åœºæ™¯ï¼‰

- CoW ç­–ç•¥å¯¼è‡´é¢‘ç¹å†™å…¥æ—¶ç¢ç‰‡å¤šï¼Œå…ƒæ•°æ®è†¨èƒ€
- å¿«ç…§æ•°é‡è¿‡å¤šæœªæ¸…ç†ï¼Œä¼šé€ æˆä¸¥é‡æ€§èƒ½ä¸‹é™
- ä¸é€‚åˆæ•°æ®åº“ã€VM é•œåƒè¿™ç±»é‡å†™åœºæ™¯

### 3. ğŸ ç¨³å®šæ€§å†å²é—®é¢˜ & ç”¨æˆ·ä¿¡å¿ƒä¸è¶³

- æ›¾æœ‰å¤šèµ·æ–‡ä»¶ç³»ç»Ÿå´©æºƒã€æŒ‚è½½å¤±è´¥ã€å…ƒæ•°æ®æŸåç­‰é—®é¢˜
- éƒ¨åˆ†å‘è¡Œç‰ˆå¦‚ RHEL å·²å¼ƒç”¨
- ç›¸æ¯” ext4/xfsï¼Œç¤¾åŒºå’Œä¼ä¸šçº§æ”¯æŒåº¦è¾ƒä½

### 4. ğŸ§° å·¥å…·é“¾ä¸æˆç†Ÿ & æ¢å¤å›°éš¾

- å›¾å½¢å·¥å…·è¾ƒå°‘ï¼Œç®¡ç†å­å·/å¿«ç…§éœ€å‘½ä»¤è¡Œæ“ä½œ
- æ–‡ä»¶ç³»ç»ŸæŸååæ¢å¤å¤æ‚ã€æˆåŠŸç‡ä¸é«˜

---

## ğŸ”š æ€»ç»“ï¼šæ˜¯å¦é€‚åˆä½ ï¼Ÿ

| åœºæ™¯ | æ˜¯å¦æ¨èä½¿ç”¨ Btrfs |
|------|------------------|
| æ—¥å¸¸æ¡Œé¢ / å¼€å‘æœº / å¿«ç…§å¤‡ä»½ | âœ… éå¸¸åˆé€‚ |
| éœ€è¦å¿«é€Ÿå¢é‡å¤‡ä»½ / å®¹å™¨é•œåƒ | âœ… æ¨è |
| æ•°æ®åº“ / å†™å¯†é›†å‹åº”ç”¨ | âŒ ä¸æ¨è |
| ä¼ä¸šçº§å­˜å‚¨ / é«˜å¯ç”¨ç³»ç»Ÿ | âŒ å»ºè®®ä½¿ç”¨ ZFS æˆ– xfs/ext4 |

> **Btrfs æ˜¯ä¸€ä¸ªâ€œåŠŸèƒ½å¼ºä½†å°šæœªå…¨é¢æˆç†Ÿâ€çš„ç°ä»£æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆæ‡‚å®ƒçš„äººï¼Œä½†ä¸ä¸€å®šé€‚åˆæ‰€æœ‰åœºæ™¯ã€‚**

---

## ğŸ”— å‚è€ƒèµ„æ–™

- [Btrfs å®˜æ–¹æ–‡æ¡£](https://btrfs.readthedocs.io/en/latest/)
- [Btrfs vs Ext4 vs XFS å¯¹æ¯”åˆ†æ](https://wiki.archlinux.org/title/Btrfs)
- [Red Hat å…³äº Btrfs çš„æ”¯æŒå£°æ˜](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/btrfs)

